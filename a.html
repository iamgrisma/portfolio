<script>
export async function onRequest(context) {
  try {
    // Fetch data from the database
    const ps = context.env.NORTHWIND_DB.prepare('SELECT * from ConvertDate');
    const data = await ps.all();

    // Generate HTML table markup
    const tableRows = data.map(row => {
      return `<tr>${Object.values(row).map(value => `<td>${value}</td>`).join('')}</tr>`;
    }).join('');

    const html = `
      <html>
      <head>
        <title>Data Table</title>
        <style>
          table {
            border-collapse: collapse;
            width: 100%;
          }
          th, td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
          }
          th {
            background-color: #f2f2f2;
          }
        </style>
      </head>
      <body>
        <h2>Data Table</h2>
        <table>
          <thead>
            <tr>${Object.keys(data[0]).map(key => `<th>${key}</th>`).join('')}</tr>
          </thead>
          <tbody>
            ${tableRows}
          </tbody>
        </table>
      </body>
      </html>
    `;

    // Return HTML response
    return new Response(html, {
      headers: {
        'Content-Type': 'text/html'
      }
    });
  } catch (error) {
    console.error('Error fetching data:', error);
    return new Response('Error fetching data', { status: 500 });
  }
}
</script>
